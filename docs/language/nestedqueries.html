<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nested Queries NEW | LMQL</title>
    <meta name="description" content="Language Model Query Language">
    <link rel="preload stylesheet" href="/assets/style.d660084a.css" as="style">
    
    <script type="module" src="/assets/app.7a112693.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.980cae92.js">
    <link rel="modulepreload" href="/assets/chunks/theme.908ddb20.js">
    <link rel="modulepreload" href="/assets/chunks/VersionSwitch.5d3190fc.js">
    <link rel="modulepreload" href="/assets/docs_language_nestedqueries.md.3fc05b78.lean.js">
    <script async src="/promptdown.js"></script>
    <script src="https://static.cloudflareinsights.com/beacon.min.js?token=f7d2a6b1a0624c51ae4dab9a4239b77d&amp;spa=false"></script>
    <script async src="https://buttons.github.io/buttons.js"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9d8abc1e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9d8abc1e data-v-7ad780c2><div class="VPNavBar has-sidebar" data-v-7ad780c2 data-v-f1abbc6e><div class="container" data-v-f1abbc6e><div class="title" data-v-f1abbc6e><div class="VPNavBarTitle has-sidebar" data-v-f1abbc6e data-v-2973dbb4><a class="title" href="/" data-v-2973dbb4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/lmql.svg" alt data-v-ab19afbb><!--]--><!--[-->LMQL<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-f1abbc6e><div class="curtain" data-v-f1abbc6e></div><div class="content-body" data-v-f1abbc6e><!--[--><!--]--><div class="VPNavBarSearch search" data-v-f1abbc6e><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-f1abbc6e data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Blog</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/research/index.html" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Research</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Docs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/playground/" target="_blank" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>â–¶ Playground</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-f1abbc6e data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-283b26e9 data-v-3329432d data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3329432d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3329432d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-f1abbc6e data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/eth-sri/lmql" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://discord.gg/5djae9gJVB" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-f1abbc6e data-v-c8c2ae4b data-v-aa8de344><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aa8de344><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-aa8de344><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-aa8de344><div class="VPMenu" data-v-aa8de344 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-c8c2ae4b><div class="item appearance" data-v-c8c2ae4b><p class="label" data-v-c8c2ae4b>Appearance</p><div class="appearance-action" data-v-c8c2ae4b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-c8c2ae4b data-v-3329432d data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3329432d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3329432d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-c8c2ae4b><div class="item social-links" data-v-c8c2ae4b><div class="VPSocialLinks social-links-list" data-v-c8c2ae4b data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/eth-sri/lmql" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://discord.gg/5djae9gJVB" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-f1abbc6e data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-9d8abc1e data-v-9e669cc1><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-9e669cc1><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-9e669cc1><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-9e669cc1>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-9e669cc1 data-v-24251f6f><button data-v-24251f6f>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-9d8abc1e data-v-ee2efba5><div class="curtain" data-v-ee2efba5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-ee2efba5><span class="visually-hidden" id="sidebar-aria-label" data-v-ee2efba5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-ee2efba5><section class="VPSidebarItem level-0 collapsible" data-v-ee2efba5 data-v-bd01e0d5><!----><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/index.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/installation.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Installation Instructions</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-ee2efba5><section class="VPSidebarItem level-0 collapsible has-active" data-v-ee2efba5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Language</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/overview.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/scripted-prompting.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Scripted Prompting</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/constraints.html" data-v-bd01e0d5><!--[--><h3 class="text" data-v-bd01e0d5>Constraints</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/constraints/custom-constraints.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Custom Constraints</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/decoding.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Decoders</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/decorators.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Decorators</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/nestedqueries.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Nested Queries <span class="badge">NEW</span></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/tools.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Tool Augmentation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/language/reference.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Language Reference</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-ee2efba5><section class="VPSidebarItem level-0 collapsible" data-v-ee2efba5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Model Support</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/index.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/hf.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Local Models / Transformers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/llama.cpp.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>llama.cpp</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/openai.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>OpenAI</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/azure.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Azure</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/models/replicate.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Replicate</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-ee2efba5><section class="VPSidebarItem level-0 collapsible" data-v-ee2efba5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Library</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/chat.html" data-v-bd01e0d5><!--[--><h3 class="text" data-v-bd01e0d5>Chat</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/chat/overview.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Your First Chatbot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/chat/serving.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Serving</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/chat/internal.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Internal Reasoning</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/chat/defend.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Defending Against Prompt Injections</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/generations.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Generations API <span class="badge">NEW</span></p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/inference-certificates.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Inference Certificates</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/output.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Output Streaming</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/python.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Python Integration</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/integrations.html" data-v-bd01e0d5><!--[--><h3 class="text" data-v-bd01e0d5>Other Integrations</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/integrations/langchain.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>LangChain</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/integrations/llama_index.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>LlamaIndex</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/lib/integrations/pandas.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Pandas</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-ee2efba5><section class="VPSidebarItem level-0 collapsible" data-v-ee2efba5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Development</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-bd01e0d5><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-bd01e0d5><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/development/dev-setup.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Development Environment</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/development/docker-setup.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>LMQL in Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/development/documentation.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Documentation</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--[--><!----><!--]--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9d8abc1e data-v-3cf691b6><div class="VPDoc has-sidebar has-aside" data-v-3cf691b6 data-v-a3c25e27><!--[--><!--]--><div class="container" data-v-a3c25e27><div class="aside" data-v-a3c25e27><div class="aside-curtain" data-v-a3c25e27></div><div class="aside-container" data-v-a3c25e27><div class="aside-content" data-v-a3c25e27><div class="VPDocAside" data-v-a3c25e27 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-cb998dce data-v-3a6c4994><div class="content" data-v-3a6c4994><div class="outline-marker" data-v-3a6c4994></div><div class="outline-title" role="heading" aria-level="2" data-v-3a6c4994>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-3a6c4994><span class="visually-hidden" id="doc-outline-aria-label" data-v-3a6c4994> Table of Contents for current page </span><ul class="root" data-v-3a6c4994 data-v-463da30f><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-a3c25e27><div class="content-container" data-v-a3c25e27><!--[--><!--]--><!----><main class="main" data-v-a3c25e27><div style="position:relative;" class="vp-doc _docs_language_nestedqueries" data-v-a3c25e27><div><h1 id="nested-queries-new" tabindex="-1">Nested Queries <span class="badge">NEW</span> <a class="header-anchor" href="#nested-queries-new" aria-label="Permalink to &quot;Nested Queries &lt;span class=&quot;badge&quot;&gt;NEW&lt;/span&gt;&quot;">â€‹</a></h1><div class="subtitle">Modularize your query code with nested prompting.</div><p><em>Nested Queries</em> allow you to execute a query function within the context of another. By nesting multiple query functions, you can build complex programs from smaller, reusable components. For this, LMQL applies the idea of <a href="https://en.wikipedia.org/wiki/Procedural_programming" target="_blank" rel="noreferrer">procedural programming</a> to prompting.</p><p>To better understand this concept, let&#39;s take a look at a simple example:</p><div class="language-lmql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lmql</span><pre class="hljs"><code><span class="line"><span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">chain_of_thought</span>():
    <span class="hljs-inline-lmql"><span class="inline-lmql-delim">&#39;&#39;&#39;lmql</span>
    <span class="hljs-string">&quot;A: Let&#39;s think step by step.\n <span class="hljs-placeholder">[REASONING]</span>&quot;</span>
    <span class="hljs-string">&quot;Therefore the answer is<span class="hljs-placeholder">[ANSWER]</span>&quot;</span> <span class="hljs-keyword">where</span> STOPS_AT(ANSWER, <span class="hljs-string">&quot;.&quot;</span>)
    <span class="hljs-keyword">return</span> ANSWER.strip()
    <span class="inline-lmql-delim">&#39;&#39;&#39;</span></span>

<span class="hljs-string">&quot;Q: It is August 12th, 2020. What date was it &quot;</span>
<span class="hljs-string">&quot;100 days ago? <span class="hljs-placeholder">[ANSWER: chain_of_thought]</span>&quot;</span>
</span></code></pre></div><p>Here, the placeholder variable <code>ANSWER</code> is annotated with a reference to query function <code>chain_of_thought</code>. This means a nested instantiation of query function <code>chain_of_thought</code> will be used to generate the value for <code>ANSWER</code>.</p><p>To understand how this behaves at runtime, consider the execution trace of this program:</p><div class="language-promptdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">promptdown</span><pre animate="true" pd-text="# Model Output
![_|Q: It is August 12th, 2020. What date was it 100 days ago?][@wait|800][@begin|incontext][chain_of_thought|A: Let&#39;s think step by step.][@wait|800][REASONING|100 days ago would be May 4th, 2020.] Therefore the answer is [@end|incontext][ANSWER|May 4th, 2020][@wait|800][@fade|incontext][@wait|800]
[:replay]" __animate="true" animate-speed="50" class="promptdown promptdown-compiled" style="opacity:1;"><h1 pd-shadow-id="203" text=" "> Model Output</h1><p pd-shadow-id="205" text="" pd-insertion-point="true"><span pd-shadow-id="206" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="207" text="" class="promptdown-var-name" style="display:none;"></span>Q: It is August 12th, 2020. What date was it 100 days ago?</span><span pd-shadow-id="210" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="211" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="215" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-yellow"><span pd-shadow-id="216" text="b" class="promptdown-var-name" style="display:none;">begin</span>incontext</span><p pd-shadow-id="220" id="incontext" text="" pd-ignore-whitespace="true" class="promptdown-container faded" style="display:inline;"><span pd-shadow-id="221" pd-instant="false" text="" class="promptdown-var color-red"><span pd-shadow-id="222" text="c" class="promptdown-var-name">chain_of_thought</span>A: Let&#39;s think step by step.</span><span pd-shadow-id="226" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="227" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="231" pd-instant="false" text="" class="promptdown-var color-yellow"><span pd-shadow-id="232" text="R" class="promptdown-var-name">REASONING</span>100 days ago would be May 4th, 2020.</span> Therefore the answer is <span pd-shadow-id="237" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-orange"><span pd-shadow-id="238" text="e" class="promptdown-var-name" style="display:none;">end</span>incontext</span></p><span pd-shadow-id="242" pd-instant="false" text="" class="promptdown-var color-ochre"><span pd-shadow-id="243" text="A" class="promptdown-var-name">ANSWER</span>May 4th, 2020</span><span pd-shadow-id="247" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="248" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="252" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-red"><span pd-shadow-id="253" text="f" class="promptdown-var-name" style="display:none;">fade</span>incontext</span><span pd-shadow-id="257" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="258" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span>
</p><button onclick="pd(this.parentElement)" class="promptdown-button-replay">â†º Replay</button></pre></div><blockquote><p>You can press <em>Replay</em> to re-run the animation.</p></blockquote><p>To generate <code>ANSWER</code>, the additional prompt and constraints defined by <code>chain_of_thought</code> are inserted into our main query context. However, after <code>ANSWER</code> has been generated, the additional instructions are removed from the trace, leaving only the return value of the nested query call. This mechanic is comparable to a function&#39;s stack frame in procedural programming.</p><p>Nesting allows you to use variable-specific instructions that are only locally relevant, without interfering with other parts of the program, encapsulating the logic of your prompts into reusable components.</p><h2 id="parameterized-queries" tabindex="-1">Parameterized Queries <a class="header-anchor" href="#parameterized-queries" aria-label="Permalink to &quot;Parameterized Queries&quot;">â€‹</a></h2><p>You can also pass parameters to nested queries, allowing you to customize their behavior:</p><div class="language-lmql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lmql</span><pre class="hljs"><code><span class="line"><span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">one_of</span>(<span class="hljs-params">choices: <span class="hljs-built_in">list</span></span>):
    <span class="hljs-inline-lmql"><span class="inline-lmql-delim">&#39;&#39;&#39;lmql</span>
    <span class="hljs-string">&quot;Among <span class="hljs-subst">{choices}</span>, what do you consider \
    most likely? <span class="hljs-placeholder">[ANSWER]</span>&quot;</span> <span class="hljs-keyword">where</span> ANSWER <span class="hljs-keyword">in</span> choices
    <span class="hljs-keyword">return</span> ANSWER
    <span class="inline-lmql-delim">&#39;&#39;&#39;</span></span>

<span class="hljs-string">&quot;Q: What is the capital of France? \
 <span class="hljs-placeholder">[ANSWER: one_of([<span class="hljs-string">&#39;Paris&#39;</span>, <span class="hljs-string">&#39;London&#39;</span>, <span class="hljs-string">&#39;Berlin&#39;</span>]</span>)]&quot;</span>
</span></code></pre></div><div class="language-promptdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">promptdown</span><pre animate="true" pd-text="# Model Output
![_|Q: What is the capital of France?][@wait|800][@begin|incontext][one_of|Among \[&#39;Paris&#39;, &#39;London&#39;, &#39;Berlin&#39;\], what do you consider most likely?][@end|incontext][@wait|800][ANSWER|Paris][@wait|800][@fade|incontext][@wait|800][:replay]" __animate="true" animate-speed="50" class="promptdown promptdown-compiled" style="opacity:1;"><h1 pd-shadow-id="265" text=" "> Model Output</h1><p pd-shadow-id="267" text="" pd-ignore-whitespace="true" pd-insertion-point="true"><span pd-shadow-id="268" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="269" text="" class="promptdown-var-name" style="display:none;"></span>Q: What is the capital of France?</span><span pd-shadow-id="272" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="273" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="277" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-yellow"><span pd-shadow-id="278" text="b" class="promptdown-var-name" style="display:none;">begin</span>incontext</span><p pd-shadow-id="282" id="incontext" text="" pd-ignore-whitespace="true" class="promptdown-container faded" style="display:inline;"><span pd-shadow-id="283" pd-instant="false" text="" class="promptdown-var color-red"><span pd-shadow-id="284" text="o" class="promptdown-var-name">one_of</span>Among [&#39;Paris&#39;, &#39;London&#39;, &#39;Berlin&#39;], what do you consider most likely?</span><span pd-shadow-id="288" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-orange"><span pd-shadow-id="289" text="e" class="promptdown-var-name" style="display:none;">end</span>incontext</span></p><span pd-shadow-id="293" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="294" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="298" pd-instant="false" text="" class="promptdown-var color-ochre"><span pd-shadow-id="299" text="A" class="promptdown-var-name">ANSWER</span>Paris</span><span pd-shadow-id="303" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="304" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span><span pd-shadow-id="308" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-red"><span pd-shadow-id="309" text="f" class="promptdown-var-name" style="display:none;">fade</span>incontext</span><span pd-shadow-id="313" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="314" text="w" class="promptdown-var-name" style="display:none;">wait</span>800</span></p><button onclick="pd(this.parentElement)" class="promptdown-button-replay">â†º Replay</button></pre></div><p>For instance, here we employ <code>one_of</code> to generate the answer to a multiple-choice question. The <code>choices</code> are passed as a parameter to the nested query, allowing us to reuse the same code for different questions.</p><h2 id="multi-part-programs" tabindex="-1">Multi-Part Programs <a class="header-anchor" href="#multi-part-programs" aria-label="Permalink to &quot;Multi-Part Programs&quot;">â€‹</a></h2><p>You can also use multiple nested queries in sequence, allowing you to repeatedly inject instructions into your prompt without interfering with the overall flow:</p><div class="language-lmql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lmql</span><pre class="hljs"><code><span class="line"><span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">dateformat</span>():
    <span class="hljs-inline-lmql"><span class="inline-lmql-delim">&#39;&#39;&#39;lmql</span>
    <span class="hljs-string">&quot;(respond in DD/MM/YYYY) <span class="hljs-placeholder">[ANSWER]</span>&quot;</span>
    <span class="hljs-keyword">return</span> ANSWER.strip()
    <span class="inline-lmql-delim">&#39;&#39;&#39;</span></span>

<span class="hljs-string">&quot;Q: When was Obama born? <span class="hljs-placeholder">[ANSWER: dateformat]</span>\n&quot;</span>
<span class="hljs-string">&quot;Q: When was Bruno Mars born? <span class="hljs-placeholder">[ANSWER: dateformat]</span>\n&quot;</span>
<span class="hljs-string">&quot;Q: When was Dua Lipa born? <span class="hljs-placeholder">[ANSWER: dateformat]</span>\n&quot;</span>

<span class="hljs-string">&quot;Out of these, who was born last?<span class="hljs-placeholder">[LAST]</span>&quot;</span>
</span></code></pre></div><div class="language-promptdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">promptdown</span><pre animate="true" pd-text="# Model Output
![_|Q: When was Obama born?][@wait|200][@begin|incontext][dateformat|(respond in DD/MM/YYYY)][@end|incontext][@wait|200][ANSWER|04/08/1961][@wait|200][@fade|incontext][@wait|200][@hide|incontext][@wait|200]
![_|Q: When was Bruno Mars born?][@wait|200][@begin|incontext1][dateformat|(respond in DD/MM/YYYY)][@end|incontext1][@wait|200][ANSWER|08/10/1985][@wait|200][@fade|incontext1][@wait|200][@hide|incontext1][@wait|200]
![_|Q: When was Dua Lipa born?][@wait|200][@begin|incontext2][dateformat|(respond in DD/MM/YYYY)][@end|incontext2][@wait|200][ANSWER|22/08/1995][@wait|200][@fade|incontext2][@wait|200][@hide|incontext2][@wait|200]

[_|Out of these, who was born last?][LAST|Dua Lipa]
[:replay]" __animate="true" animate-speed="50" class="promptdown promptdown-compiled" style="opacity:1;"><h1 pd-shadow-id="320" text=" "> Model Output</h1><p pd-shadow-id="322" text="" pd-insertion-point="true"><span pd-shadow-id="323" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="324" text="" class="promptdown-var-name" style="display:none;"></span>Q: When was Obama born?</span><span pd-shadow-id="327" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="328" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="332" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-yellow"><span pd-shadow-id="333" text="b" class="promptdown-var-name" style="display:none;">begin</span>incontext</span><p pd-shadow-id="337" id="incontext" text="" pd-ignore-whitespace="true" class="promptdown-container faded" style="display:none;"><span pd-shadow-id="338" pd-instant="false" text="" class="promptdown-var color-yellow"><span pd-shadow-id="339" text="d" class="promptdown-var-name">dateformat</span>(respond in DD/MM/YYYY)</span><span pd-shadow-id="343" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-orange"><span pd-shadow-id="344" text="e" class="promptdown-var-name" style="display:none;">end</span>incontext</span></p><span pd-shadow-id="348" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="349" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="353" pd-instant="false" text="" class="promptdown-var color-ochre"><span pd-shadow-id="354" text="A" class="promptdown-var-name">ANSWER</span>04/08/1961</span><span pd-shadow-id="358" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="359" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="363" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-red"><span pd-shadow-id="364" text="f" class="promptdown-var-name" style="display:none;">fade</span>incontext</span><span pd-shadow-id="368" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="369" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="373" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-ochre"><span pd-shadow-id="374" text="h" class="promptdown-var-name" style="display:none;">hide</span>incontext</span><span pd-shadow-id="378" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="379" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span>
<span pd-shadow-id="384" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="385" text="" class="promptdown-var-name" style="display:none;"></span>Q: When was Bruno Mars born?</span><span pd-shadow-id="388" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="389" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="393" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-yellow"><span pd-shadow-id="394" text="b" class="promptdown-var-name" style="display:none;">begin</span>incontext1</span><p pd-shadow-id="398" id="incontext1" text="" pd-ignore-whitespace="true" class="promptdown-container faded" style="display:none;"><span pd-shadow-id="399" pd-instant="false" text="" class="promptdown-var color-yellow"><span pd-shadow-id="400" text="d" class="promptdown-var-name">dateformat</span>(respond in DD/MM/YYYY)</span><span pd-shadow-id="404" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-orange"><span pd-shadow-id="405" text="e" class="promptdown-var-name" style="display:none;">end</span>incontext1</span></p><span pd-shadow-id="409" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="410" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="414" pd-instant="false" text="" class="promptdown-var color-ochre"><span pd-shadow-id="415" text="A" class="promptdown-var-name">ANSWER</span>08/10/1985</span><span pd-shadow-id="419" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="420" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="424" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-red"><span pd-shadow-id="425" text="f" class="promptdown-var-name" style="display:none;">fade</span>incontext1</span><span pd-shadow-id="429" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="430" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="434" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-ochre"><span pd-shadow-id="435" text="h" class="promptdown-var-name" style="display:none;">hide</span>incontext1</span><span pd-shadow-id="439" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="440" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span>
<span pd-shadow-id="445" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="446" text="" class="promptdown-var-name" style="display:none;"></span>Q: When was Dua Lipa born?</span><span pd-shadow-id="449" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="450" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="454" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-yellow"><span pd-shadow-id="455" text="b" class="promptdown-var-name" style="display:none;">begin</span>incontext2</span><p pd-shadow-id="459" id="incontext2" text="" pd-ignore-whitespace="true" class="promptdown-container faded" style="display:none;"><span pd-shadow-id="460" pd-instant="false" text="" class="promptdown-var color-yellow"><span pd-shadow-id="461" text="d" class="promptdown-var-name">dateformat</span>(respond in DD/MM/YYYY)</span><span pd-shadow-id="465" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-orange"><span pd-shadow-id="466" text="e" class="promptdown-var-name" style="display:none;">end</span>incontext2</span></p><span pd-shadow-id="470" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="471" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="475" pd-instant="false" text="" class="promptdown-var color-ochre"><span pd-shadow-id="476" text="A" class="promptdown-var-name">ANSWER</span>22/08/1995</span><span pd-shadow-id="480" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="481" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="485" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-red"><span pd-shadow-id="486" text="f" class="promptdown-var-name" style="display:none;">fade</span>incontext2</span><span pd-shadow-id="490" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="491" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span><span pd-shadow-id="495" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-ochre"><span pd-shadow-id="496" text="h" class="promptdown-var-name" style="display:none;">hide</span>incontext2</span><span pd-shadow-id="500" pd-instant="false" pd-cmd="true" text="" class="promptdown-var cmd color-pink"><span pd-shadow-id="501" text="w" class="promptdown-var-name" style="display:none;">wait</span>200</span>

<span pd-shadow-id="506" pd-instant="false" text="" class="promptdown-var color-none"><span pd-shadow-id="507" text="" class="promptdown-var-name" style="display:none;"></span>Out of these, who was born last?</span><span pd-shadow-id="510" pd-instant="false" text="" class="promptdown-var color-pink"><span pd-shadow-id="511" text="L" class="promptdown-var-name">LAST</span>Dua Lipa</span>
</p><button onclick="pd(this.parentElement)" class="promptdown-button-replay">â†º Replay</button></pre></div><p>We instruct the model to use a specific date format when answering our initial questions. Because of the use of <code>dateformat</code> as a nested function, the instructions are only temporarily included, once per generated answer, and removed before moving on to the next question.</p><p>Once we have generated all intermediate answers, we query the LLM to compare the individual dates and determine the latest one, where this last query is not affected by the instructions of <code>dateformat</code>.</p><h2 id="return-values" tabindex="-1">Return Values <a class="header-anchor" href="#return-values" aria-label="Permalink to &quot;Return Values&quot;">â€‹</a></h2><p>If a query function does <em>not</em> return a value, calling it as nested function does <em>not</em> remove the inserted instructions after execution. The effect of a nested function without return value therefore corresponds to a macro expansion, as shown below:</p><p>This can be helpful when you want to use a fixed template in several locations, e.g. for list items. Further, as shown below, a nested function can also be parameterized to customize its behavior.</p><div class="language-lmql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lmql</span><pre class="hljs"><code><span class="line"><span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">items_list</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-inline-lmql"><span class="inline-lmql-delim">&#39;&#39;&#39;lmql</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
        <span class="hljs-string">&quot;-<span class="hljs-placeholder">[ITEM]</span>&quot;</span> <span class="hljs-keyword">where</span> STOPS_AT(ITEM, <span class="hljs-string">&quot;\n&quot;</span>)
    <span class="inline-lmql-delim">&#39;&#39;&#39;</span></span>

<span class="hljs-string">&quot;A list of things not to forget to pack for your \
 next trip:\n<span class="hljs-placeholder">[ITEMS: items_list(<span class="hljs-number">4</span>)]</span>&quot;</span>
</span></code></pre></div><div class="language-promptdown vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">promptdown</span><pre pd-text="![_|A list of things not to forget to pack for your next trip:]
![ITEM|- Passport]
![ITEM|- Toothbrush]
![ITEM|- Phone charger]
![ITEM|- Sunscreen]
" animate="true" __animate="true" animate-speed="50" class="promptdown promptdown-compiled" style="opacity:1;"><p pd-shadow-id="517" text="" pd-insertion-point="true"><span pd-shadow-id="518" pd-instant="true" text="" class="promptdown-var color-none"><span pd-shadow-id="519" text="" class="promptdown-var-name" style="display:none;"></span>A list of things not to forget to pack for your next trip:</span>
<span pd-shadow-id="523" pd-instant="true" text="" class="promptdown-var color-lightorange"><span pd-shadow-id="524" text="I" class="promptdown-var-name">ITEM</span>- Passport</span>
<span pd-shadow-id="529" pd-instant="true" text="" class="promptdown-var color-lightorange"><span pd-shadow-id="530" text="I" class="promptdown-var-name">ITEM</span>- Toothbrush</span>
<span pd-shadow-id="535" pd-instant="true" text="" class="promptdown-var color-lightorange"><span pd-shadow-id="536" text="I" class="promptdown-var-name">ITEM</span>- Phone charger</span>
<span pd-shadow-id="541" pd-instant="true" text="" class="promptdown-var color-lightorange"><span pd-shadow-id="542" text="I" class="promptdown-var-name">ITEM</span>- Sunscreen</span>
</p></pre></div><h2 id="nested-queries-in-python" tabindex="-1">Nested Queries in Python <a class="header-anchor" href="#nested-queries-in-python" aria-label="Permalink to &quot;Nested Queries in Python&quot;">â€‹</a></h2><p>To use nested queries from a Python context, you can just reference one <code>@lmql.query</code> function from another.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="hljs"><code><span class="line"><span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">dateformat</span>():
    <span class="hljs-inline-lmql"><span style="opacity:0.4;">&#39;&#39;&#39;lmql</span>
    <span class="hljs-string">&quot;(respond in DD/MM/YYYY)<span class="hljs-placeholder">[ANSWER]</span>&quot;</span>
    <span class="hljs-keyword">return</span> ANSWER.strip()
    &#39;&#39;&#39;</span>

<span class="hljs-meta">@lmql.query</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main_query</span>():
    <span class="hljs-inline-lmql">&#39;&#39;&#39;lmql
    <span class="hljs-string">&quot;Q: It is August 12th, 2020. What date was it \
    100 days ago? <span class="hljs-placeholder">[ANSWER: dateformat]</span>&quot;</span>
    &#39;&#39;&#39;</span>
</span></code></pre></div><p>Here, <code>main_query</code> references <code>dateformat</code> as a nested query, where both functions are defined on the top level of the same file. However, you can also import and reuse query code from other files, as long as they are accessible from the scope of you main query function. Using this ability you can write libraries of reusable query functions to be used across your application or even by other users.</p></div></div></main><footer class="VPDocFooter" data-v-a3c25e27 data-v-a2d931e4><!--[--><!--]--><!----><nav class="prev-next" data-v-a2d931e4><div class="pager" data-v-a2d931e4><a class="pager-link prev" href="/docs/language/decorators.html" data-v-a2d931e4><span class="desc" data-v-a2d931e4>Previous page</span><span class="title" data-v-a2d931e4>Decorators</span></a></div><div class="pager" data-v-a2d931e4><a class="pager-link next" href="/docs/language/tools.html" data-v-a2d931e4><span class="desc" data-v-a2d931e4>Next page</span><span class="title" data-v-a2d931e4>Tool Augmentation</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"readme.md\":\"82e2e066\",\"docs_development_documentation.md\":\"b9530bbc\",\"docs_installation.md\":\"8739ce92\",\"blog_posts_release-0.7.md\":\"c15b0585\",\"features__1-types.md\":\"2e12a0c5\",\"docs_lib_chat_defend.md\":\"c253ac92\",\"docs_latest_development_dev-setup.md\":\"18f17674\",\"features_3-models.md\":\"eaf28c02\",\"docs_development_dev-setup.md\":\"94c94af5\",\"docs_lib_python.md\":\"cadfdfc8\",\"features_examples_2-constraining.md\":\"cda9d411\",\"docs_development_docker-setup.md\":\"0e3e1b2c\",\"features_examples_3-multi-part.md\":\"8bbbe3a5\",\"docs_lib_generations.md\":\"4968526e\",\"docs_latest_models_llama.cpp.md\":\"9e418aff\",\"docs_latest_installation.md\":\"4aae67b7\",\"features_examples_3.6-python.md\":\"376501ff\",\"features_examples_2.5-data-types.md\":\"7dcc82ab\",\"docs_lib_integrations_pandas.md\":\"e687e8a5\",\"docs_lib_inference-certificates.md\":\"2dd708f1\",\"docs_lib_output.md\":\"6e90a5e7\",\"docs_latest_lib_integrations_pandas.md\":\"9b6d3f34\",\"docs_latest_lib_output.md\":\"4442e9f8\",\"docs_latest_development_documentation.md\":\"c26b8856\",\"blog_posts_release-0.0.6.md\":\"2111a972\",\"docs_models_azure.md\":\"167a3758\",\"features_examples_4-meta-prompting.md\":\"19152cd4\",\"docs_latest_language_decorators.md\":\"53bd4b02\",\"features_examples_3.5-distributions.md\":\"9d7164a2\",\"features_examples_5-wikipedia.md\":\"0f7e4309\",\"docs_latest_language_constraints_custom-constraints.md\":\"a673b22d\",\"docs_latest_index.md\":\"45032e16\",\"docs_latest_language_constraints.md\":\"78575736\",\"docs_lib_integrations_langchain.md\":\"82a1a8ce\",\"docs_latest_language_overview.md\":\"7387dad8\",\"docs_models_hf.md\":\"00577347\",\"docs_language_tools.md\":\"9aaa96de\",\"blog_posts_release-0.0.6.1.md\":\"120a8d77\",\"docs_lib_chat_serving.md\":\"20842128\",\"docs_latest_development_docker-setup.md\":\"fa59e371\",\"docs_models_index.md\":\"6438cd2a\",\"blog_posts_release-0.0.6.4.md\":\"a07e6028\",\"features_examples_1-packing-list.md\":\"6002788c\",\"docs_latest_models_index.md\":\"d5054f5a\",\"docs_latest_models_hf.md\":\"db4e71b2\",\"docs_index.md\":\"526a0692\",\"docs_latest_lib_integrations_llama_index.md\":\"4f2fe1b9\",\"docs_language_constraints_custom-constraints.md\":\"f81b18dd\",\"docs_language_decoding.md\":\"438d43b9\",\"blog_posts_release-0.0.6.5.md\":\"a82e82a9\",\"docs_lib_integrations.md\":\"f23c2c07\",\"docs_latest_language_reference.md\":\"26684918\",\"docs_latest_language_tools.md\":\"b9561422\",\"docs_latest_models_azure.md\":\"d18f3972\",\"docs_latest_language_decoding.md\":\"018937f6\",\"docs_lib_chat_internal.md\":\"27691cc3\",\"docs_models_llama.cpp.md\":\"ea29eacf\",\"docs_latest_language_nestedqueries.md\":\"815f2dd9\",\"blog_index.md\":\"2bf582de\",\"docs_models_replicate.md\":\"14be5a06\",\"docs_lib_chat_overview.md\":\"462f2835\",\"docs_lib_chat.md\":\"f8be0cb3\",\"blog_posts_release-0.0.5.md\":\"6f3e470e\",\"blog_posts_release-0.0.6.3.md\":\"a170b883\",\"docs_language_decorators.md\":\"9a3eb9c2\",\"features_2-nested.md\":\"3c4c00f3\",\"docs_language_reference.md\":\"93969594\",\"docs_language_nestedqueries.md\":\"3fc05b78\",\"docs_latest_lib_chat_defend.md\":\"5cbe2338\",\"docs_latest_lib_chat_internal.md\":\"fc68f234\",\"docs_latest_lib_chat_overview.md\":\"aa834f5b\",\"docs_latest_lib_python.md\":\"1c370ca3\",\"docs_latest_lib_chat_serving.md\":\"c33c8e48\",\"docs_latest_lib_generations.md\":\"e8df2635\",\"docs_latest_lib_inference-certificates.md\":\"414275b7\",\"docs_latest_lib_integrations.md\":\"eb75ecfa\",\"docs_language_scripted-prompting.md\":\"1a472d51\",\"docs_latest_lib_integrations_langchain.md\":\"42ff678a\",\"docs_latest_language_scripted-prompting.md\":\"12afea6e\",\"docs_latest_lib_chat.md\":\"00476b1d\",\"docs_language_overview.md\":\"4e5dda69\",\"blog_posts_release-0.0.6.6.md\":\"958a76e8\",\"docs_models_openai.md\":\"39ade1fd\",\"features_examples_6-chat.md\":\"cc86c446\",\"index.md\":\"424958cb\",\"research_index.md\":\"c26a598e\",\"docs_latest_models_openai.md\":\"0ecf2534\",\"docs_latest_models_replicate.md\":\"4762e61c\",\"features_1-code.md\":\"356f0c36\",\"docs_lib_integrations_llama_index.md\":\"f3803dc1\",\"docs_language_constraints.md\":\"43fe4757\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"LMQL\",\"description\":\"Language Model Query Language\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Blog\",\"link\":\"/blog/\",\"activeMatch\":\"^/blog/\"},{\"text\":\"Research\",\"link\":\"/research/index.html\"},{\"text\":\"Docs\",\"link\":\"/docs/\",\"activeMatch\":\"^/docs/\"},{\"text\":\"â–¶ Playground\",\"link\":\"/playground/\",\"target\":\"_blank\"}],\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"TCP95GVDMD\",\"apiKey\":\"f7b4c9cd024536f8085f160045c3aafe\",\"indexName\":\"lmql\"}},\"logo\":\"/lmql.svg\",\"sidebar\":{\"docs/\":[{\"text\":\"\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/index.md\"},{\"text\":\"Installation Instructions\",\"link\":\"/installation.md\"}]},{\"text\":\"Language\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/language\",\"items\":[{\"text\":\"Overview\",\"link\":\"/overview.md\"},{\"text\":\"Scripted Prompting\",\"link\":\"/scripted-prompting.md\"},{\"text\":\"Constraints\",\"link\":\"/constraints.md\",\"activeMatch\":\"^/docs/language/constraints/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"Custom Constraints\",\"link\":\"/constraints/custom-constraints.md\"}]},{\"text\":\"Decoders\",\"link\":\"/decoding.md\"},{\"text\":\"Decorators\",\"link\":\"/decorators.md\"},{\"text\":\"Nested Queries <span class=\\\"badge\\\">NEW</span>\",\"link\":\"/nestedqueries.md\"},{\"text\":\"Tool Augmentation\",\"link\":\"/tools.md\"},{\"text\":\"Language Reference\",\"link\":\"/reference.md\"}]},{\"text\":\"Model Support\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/models\",\"items\":[{\"text\":\"Overview\",\"link\":\"/index.md\"},{\"text\":\"Local Models / Transformers\",\"link\":\"/hf.md\"},{\"text\":\"llama.cpp\",\"link\":\"/llama.cpp.md\"},{\"text\":\"OpenAI\",\"link\":\"/openai.md\"},{\"text\":\"Azure\",\"link\":\"/azure.md\"},{\"text\":\"Replicate\",\"link\":\"/replicate.md\"}]},{\"text\":\"Library\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/lib\",\"items\":[{\"text\":\"Chat\",\"link\":\"/chat.md\",\"activeMatch\":\"^/docs/lib/chat/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"Your First Chatbot\",\"link\":\"/chat/overview.md\"},{\"text\":\"Serving\",\"link\":\"/chat/serving.md\"},{\"text\":\"Internal Reasoning\",\"link\":\"/chat/internal.md\"},{\"text\":\"Defending Against Prompt Injections\",\"link\":\"/chat/defend.md\"}]},{\"text\":\"Generations API <span class=\\\"badge\\\">NEW</span>\",\"link\":\"/generations.md\"},{\"text\":\"Inference Certificates\",\"link\":\"/inference-certificates.md\"},{\"text\":\"Output Streaming\",\"link\":\"/output.md\"},{\"text\":\"Python Integration\",\"link\":\"/python.md\"},{\"text\":\"Other Integrations\",\"link\":\"/integrations.md\",\"activeMatch\":\"^/docs/lib/integrations/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"LangChain\",\"link\":\"/integrations/langchain.md\"},{\"text\":\"LlamaIndex\",\"link\":\"/integrations/llama_index.md\"},{\"text\":\"Pandas\",\"link\":\"/integrations/pandas.md\"}]}]},{\"text\":\"Development\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/development\",\"items\":[{\"text\":\"Development Environment\",\"link\":\"/dev-setup.md\"},{\"text\":\"LMQL in Docker\",\"link\":\"/docker-setup.md\"},{\"text\":\"Documentation\",\"link\":\"/documentation.md\"}]}],\"docs/latest/\":[{\"text\":\"\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/latest/\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/index.md\"},{\"text\":\"Installation Instructions\",\"link\":\"/installation.md\"}]},{\"text\":\"Language\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/latest/language\",\"items\":[{\"text\":\"Overview\",\"link\":\"/overview.md\"},{\"text\":\"Scripted Prompting\",\"link\":\"/scripted-prompting.md\"},{\"text\":\"Constraints\",\"link\":\"/constraints.md\",\"activeMatch\":\"^/docs/latest/language/constraints/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"Custom Constraints\",\"link\":\"/constraints/custom-constraints.md\"}]},{\"text\":\"Decoders\",\"link\":\"/decoding.md\"},{\"text\":\"Decorators\",\"link\":\"/decorators.md\"},{\"text\":\"Nested Queries <span class=\\\"badge\\\">NEW</span>\",\"link\":\"/nestedqueries.md\"},{\"text\":\"Tool Augmentation\",\"link\":\"/tools.md\"},{\"text\":\"Language Reference\",\"link\":\"/reference.md\"}]},{\"text\":\"Model Support\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/latest/models\",\"items\":[{\"text\":\"Overview\",\"link\":\"/index.md\"},{\"text\":\"Local Models / Transformers\",\"link\":\"/hf.md\"},{\"text\":\"llama.cpp\",\"link\":\"/llama.cpp.md\"},{\"text\":\"OpenAI\",\"link\":\"/openai.md\"},{\"text\":\"Azure\",\"link\":\"/azure.md\"},{\"text\":\"Replicate\",\"link\":\"/replicate.md\"}]},{\"text\":\"Library\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/latest/lib\",\"items\":[{\"text\":\"Chat\",\"link\":\"/chat.md\",\"activeMatch\":\"^/docs/latest/lib/chat/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"Your First Chatbot\",\"link\":\"/chat/overview.md\"},{\"text\":\"Serving\",\"link\":\"/chat/serving.md\"},{\"text\":\"Internal Reasoning\",\"link\":\"/chat/internal.md\"},{\"text\":\"Defending Against Prompt Injections\",\"link\":\"/chat/defend.md\"}]},{\"text\":\"Generations API <span class=\\\"badge\\\">NEW</span>\",\"link\":\"/generations.md\"},{\"text\":\"Inference Certificates\",\"link\":\"/inference-certificates.md\"},{\"text\":\"Output Streaming\",\"link\":\"/output.md\"},{\"text\":\"Python Integration\",\"link\":\"/python.md\"},{\"text\":\"Other Integrations\",\"link\":\"/integrations.md\",\"activeMatch\":\"^/docs/latest/lib/integrations/\",\"collapsable\":true,\"collapsed\":true,\"items\":[{\"text\":\"LangChain\",\"link\":\"/integrations/langchain.md\"},{\"text\":\"LlamaIndex\",\"link\":\"/integrations/llama_index.md\"},{\"text\":\"Pandas\",\"link\":\"/integrations/pandas.md\"}]}]},{\"text\":\"Development\",\"collapsable\":true,\"collapsed\":false,\"base\":\"/docs/latest/development\",\"items\":[{\"text\":\"Development Environment\",\"link\":\"/dev-setup.md\"},{\"text\":\"LMQL in Docker\",\"link\":\"/docker-setup.md\"},{\"text\":\"Documentation\",\"link\":\"/documentation.md\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/eth-sri/lmql\"},{\"icon\":\"discord\",\"link\":\"https://discord.gg/5djae9gJVB\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>